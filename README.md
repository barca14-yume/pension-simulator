# 年金・資産ギャップシミュレーター

保険・IFA営業向けの軽量な年金・資産シミュレーターです。営業現場でのクイックなWhat-ifデモに最適化されています。

## 特徴

- **営業特化UI**: Surface 3:2ディスプレイ対応、タッチ・ペン・キーボード操作
- **リアルタイム計算**: 入力変更から300ms後に自動再計算
- **3つのプリセット**: 保守的・標準・積極的な想定を即座に切り替え
- **Monte Carloシミュレーション**: 500回試行による破綻確率の算出
- **エクスポート機能**: CSV/JSON出力、URL共有、印刷対応
- **営業モード**: 余白減・文字大きめ・高コントラスト・アニメ最小化

## 技術スタック

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Charts**: Recharts
- **State**: Zustand
- **Testing**: Vitest + Testing Library

## セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev

# ブラウザで開く
# http://localhost:3000
```

## 使い方

### 基本操作

1. **プリセット選択**: ヘッダーで「保守的」「標準」「積極的」を選択
2. **入力**: 左パネルのアコーディオンから各項目を入力
3. **結果確認**: 右パネルのタブで「サマリー」「年次推移」「前提・係数」「エクスポート」を切り替え
4. **営業モード**: ヘッダーの「営業モード」ボタンで表示を最適化

### 主要機能

#### KPIカード（上部3枚）
- **生涯受取合計**: 公的年金＋私的年金の総額
- **リタイア時点の資産状況**: 退職時の余剰/不足（実質NPV）
- **破綻確率**: Monte Carlo有効時の資産枯渇確率

#### グラフ
- **資産残高推移**: 年齢別の資産残高
- **収入・支出推移**: 給与・年金・支出のスタック表示
- **Monte Carloシミュレーション**: パーセンタイル別の資産推移

#### エクスポート
- **CSV**: Excel等で開ける年次推移データ
- **JSON**: 入力データ＋年次推移の完全データ
- **URL共有**: 設定をURLエンコードして共有
- **印刷**: A4横向きのプリント最適化

### 営業トーク例

```
「この画面は制度を簡略化した目安です。
右上『前提・係数』で御社基準に調整できます。
税務・加入要件は別途ご確認ください。」
```

## 計算ロジック

### 年次タイムライン

各年で以下を計算：

1. **収入**
   - 給与: `年収 × (1 + 給与成長率)^経過年数`
   - 公的年金: `基礎年金 + 報酬比例部分`（65歳から）
   - 私的年金: 指定年齢から定額

2. **支出**
   - 生活費: 現役時は現在額、退職後は`現在額 × 退職後生活費率`
   - 育児費: 子供が22歳まで
   - 住宅費: 指定年齢まで

3. **資産運用**
   - `残高(t+1) = 残高(t) × (1 + リターン) + 純CF`
   - Monte Carlo時はリターンを正規分布で変動

### 公的年金（簡易計算）

```
基礎年金 = 満額 × 加入率
報酬比例 = 係数 × 平均標準報酬月額 × 12
合計 = 基礎年金 + 報酬比例
```

### 遺族年金（簡易計算）

本人死亡時：
- 死亡保険金を一時金として資産に加算
- 配偶者に`基礎年金 × 遺族年金率`を指定年数支給

## 設定ファイル

### `/config.ts`

システム全体の定数・係数を管理：

```typescript
export const config = {
  statutoryPensionStartAge: 65,  // 公的年金開始年齢
  basicPensionFullAmountDefault: 816000,  // 基礎年金満額（令和6年度）
  monteCarloIterations: 500,  // MC試行回数
  maxAge: 100,  // 最大生存年齢
  // ...
}
```

### `/data/presets.ts`

3つのプリセット定義：

- **Conservative（保守的）**: リターン1.5%、インフレ1.0%
- **Base（標準）**: リターン3.0%、インフレ1.5%（デフォルト）
- **Aggressive（積極的）**: リターン4.5%、インフレ2.0%

## テスト

```bash
# 全テスト実行
npm test

# UIモード
npm run test:ui
```

### テストケース

- ✅ 基本ケース（40歳独身、退職65歳、95歳まで資産プラス）
- ✅ 遺族年金（55歳死亡時の一時金＋遺族年金）
- ✅ URL状態のラウンドトリップ
- ✅ CSV/JSONエクスポートの列・データ検証

## ディスクレーマー

⚠️ **重要な注意事項**

この画面は公的年金制度を簡略化した目安です。実際の年金額は以下により異なります：

- 加入期間・報酬額の詳細
- 制度改正（マクロ経済スライド等）
- 税金・社会保険料
- 遺族年金・障害年金の詳細な受給要件

投資リターンは保証されるものではありません。実際の運用成績は市場環境により変動します。

## カスタマイズ

### 係数の調整

`/config.ts`で以下を調整可能：

- 公的年金開始年齢
- 基礎年金満額
- Monte Carlo試行回数
- バリデーション閾値

### プリセットの追加

`/data/presets.ts`に新しいプリセットを追加：

```typescript
export const presets = {
  // 既存のプリセット...
  Custom: {
    name: 'Custom',
    label: 'カスタム',
    expectedReturn: 0.025,
    inflationRate: 0.012,
    salaryGrowthRate: 0.008,
    volatility: 12,
    description: 'カスタム設定',
  },
}
```

## ライセンス

MIT

## サポート

問題や要望は GitHub Issues までお願いします。
